# 需求文档

## 简介

本实验旨在验证一个核心假设：在河牌阶段，使用"手牌VS对手范围"和"我的范围VS对手范围"计算的胜率标量，是否能够替代传统Solver（如wasm-postflop）所需的完整信息来进行策略求解。

传统Solver需要以下信息：
1. 手牌（Hole Cards）
2. 公共牌（Community Cards）
3. 对手范围（Opponent Range）
4. 我的范围（My Range）

本实验探索是否可以用简化的胜率表示（考虑死牌移除）来近似这些信息，从而简化策略计算。

## 术语表

- **Solver**: 博弈论求解器，用于计算纳什均衡策略（如wasm-postflop）
- **Equity**: 胜率，手牌在特定公共牌面下对抗对手范围的获胜概率
- **Range（范围）**: 玩家可能持有的所有手牌组合及其权重
- **Dead Card Removal（死牌移除）**: 从对手范围中移除与已知牌冲突的手牌组合
- **EV（期望值）**: 某个动作的期望收益
- **Indifference（无差异）**: 纳什均衡中，被混合策略选择的动作具有相同的EV

## 需求

### 需求1

**用户故事：** 作为研究者，我想计算河牌阶段"手牌VS对手范围"的胜率，以便与Solver结果进行对比。

#### 验收标准

1. WHEN 给定一个具体手牌、5张公共牌和对手范围 THEN 系统 SHALL 计算该手牌对抗对手范围的精确胜率（考虑死牌移除）
2. WHEN 计算胜率时 THEN 系统 SHALL 从对手范围中移除与我的手牌和公共牌冲突的组合
3. WHEN 胜率计算完成 THEN 系统 SHALL 返回一个0到1之间的标量值

### 需求2

**用户故事：** 作为研究者，我想计算河牌阶段"我的范围VS对手范围"的胜率矩阵，以便分析范围对抗范围的情况。

#### 验收标准

1. WHEN 给定我的范围、对手范围和5张公共牌 THEN 系统 SHALL 计算范围内每个手牌组合对抗对手范围的胜率
2. WHEN 计算范围VS范围胜率时 THEN 系统 SHALL 对每个手牌组合应用正确的死牌移除
3. WHEN 计算完成 THEN 系统 SHALL 返回一个胜率向量，每个元素对应我的范围中的一个手牌组合

### 需求3

**用户故事：** 作为研究者，我想使用wasm-postflop Solver计算参考策略，以便作为验证的基准。

#### 验收标准

1. WHEN 给定游戏树配置（底池大小、筹码深度、下注选项）THEN 系统 SHALL 调用wasm-postflop计算纳什均衡策略
2. WHEN Solver计算完成 THEN 系统 SHALL 提取每个手牌在当前节点的动作概率分布
3. WHEN 提取策略时 THEN 系统 SHALL 同时获取每个动作的EV值

### 需求4

**用户故事：** 作为研究者，我想对比胜率方法和Solver方法的策略差异，以便验证假设的有效性。

#### 验收标准

1. WHEN 给定胜率向量和Solver策略 THEN 系统 SHALL 计算基于胜率的简化策略
2. WHEN 对比策略时 THEN 系统 SHALL 计算两种策略之间的差异度量（如KL散度、总变差距离）
3. WHEN 分析完成 THEN 系统 SHALL 生成对比报告，包含策略差异、EV差异等指标

### 需求5

**用户故事：** 作为研究者，我想在多个不同场景下运行验证实验，以便评估方法的通用性。

#### 验收标准

1. WHEN 设计实验时 THEN 系统 SHALL 支持配置不同的公共牌面、范围和游戏树参数
2. WHEN 运行批量实验时 THEN 系统 SHALL 记录每个场景的详细结果
3. WHEN 实验完成 THEN 系统 SHALL 汇总统计结果，包括平均误差、最大误差、相关系数等

### 需求6

**用户故事：** 作为研究者，我想可视化胜率与Solver策略之间的关系，以便直观理解两者的对应关系。

#### 验收标准

1. WHEN 分析完成 THEN 系统 SHALL 生成胜率-策略散点图
2. WHEN 可视化时 THEN 系统 SHALL 标注不同动作类型（fold/call/raise）的分布
3. WHEN 生成图表时 THEN 系统 SHALL 支持导出为PNG或SVG格式
