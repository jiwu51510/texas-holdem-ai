# 需求文档

## 简介

本功能旨在使策略查看器能够自适应不同的模型结构，特别是动态获取模型的动作空间维度和动作名称，而不是使用硬编码的动作列表。这样可以确保策略查看器能够正确显示任何训练好的模型的策略，无论模型使用的是4维、5维还是6维的动作空间。

## 术语表

- **动作空间（Action Space）**：模型可以输出的所有可能动作的集合
- **动作维度（Action Dimension）**：动作空间的大小，即模型输出层的维度
- **策略网络（Policy Network）**：输出动作概率分布的神经网络
- **遗憾网络（Regret Network）**：输出每个动作遗憾值的神经网络（Deep CFR架构）
- **动作映射（Action Mapping）**：从动作索引到动作名称的映射关系
- **检查点元数据（Checkpoint Metadata）**：保存在检查点文件中的模型配置信息

## 需求

### 需求 1

**用户故事：** 作为AI研究员，我希望策略查看器能够自动检测模型的动作空间维度，以便正确显示不同模型的策略。

#### 验收标准

1. WHEN 加载检查点文件 THEN 策略查看器 SHALL 从模型权重中自动检测动作空间维度
2. WHEN 检查点包含动作映射元数据 THEN 策略查看器 SHALL 使用该元数据中的动作名称
3. WHEN 检查点不包含动作映射元数据 THEN 策略查看器 SHALL 根据动作维度使用默认的动作名称映射
4. WHEN 动作维度检测完成 THEN 策略查看器 SHALL 在元数据中显示检测到的动作数量

### 需求 2

**用户故事：** 作为AI研究员，我希望策略计算器能够根据模型的动作空间动态生成策略，以便正确分析任何模型的决策。

#### 验收标准

1. WHEN 计算节点策略 THEN 策略计算器 SHALL 使用从模型获取的动作列表而非硬编码列表
2. WHEN 模型输出概率分布 THEN 策略计算器 SHALL 将每个输出维度映射到对应的动作名称
3. WHEN 归一化策略概率 THEN 策略计算器 SHALL 确保所有动作概率之和为1.0
4. WHEN 显示策略详情 THEN 策略查看器 SHALL 显示模型实际支持的所有动作

### 需求 3

**用户故事：** 作为AI研究员，我希望训练时保存的检查点包含动作映射信息，以便策略查看器能够正确解释模型输出。

#### 验收标准

1. WHEN 保存检查点 THEN 训练系统 SHALL 在检查点中包含动作名称列表
2. WHEN 保存检查点 THEN 训练系统 SHALL 在检查点中包含动作维度信息
3. WHEN 加载旧格式检查点 THEN 策略查看器 SHALL 使用向后兼容的默认动作映射

### 需求 4

**用户故事：** 作为AI研究员，我希望策略分析器能够正确处理不同动作维度的模型，以便比较不同配置的模型策略。

#### 验收标准

1. WHEN 分析状态策略 THEN 策略分析器 SHALL 根据模型的实际动作维度返回正确数量的动作概率
2. WHEN 生成策略热图 THEN 策略分析器 SHALL 使用模型的实际动作列表作为列标签
3. WHEN 比较多个模型 THEN 策略分析器 SHALL 正确处理动作维度不同的模型

### 需求 5

**用户故事：** 作为AI研究员，我希望UI组件能够自适应显示不同数量的动作，以便完整展示模型的策略分布。

#### 验收标准

1. WHEN 显示策略详情 THEN 策略详情控件 SHALL 动态生成与动作数量匹配的概率条
2. WHEN 显示颜色映射 THEN 颜色映射器 SHALL 支持任意数量的动作类型
3. WHEN 导出策略数据 THEN 导出的JSON SHALL 包含模型实际支持的所有动作

### 需求 6

**用户故事：** 作为AI研究员，我希望手牌矩阵单元格使用条状组合显示策略分布，以便直观地看到每个手牌的混合策略。

#### 验收标准

1. WHEN 显示手牌矩阵单元格 THEN 策略查看器 SHALL 使用水平条状组合显示各动作的概率比例
2. WHEN 显示RAISE类动作 THEN 策略查看器 SHALL 使用红色系颜色（RAISE_BIG使用深红色，RAISE_SMALL使用浅红色，ALL_IN使用最深红色）
3. WHEN 显示CHECK或CALL动作 THEN 策略查看器 SHALL 使用绿色
4. WHEN 显示FOLD动作 THEN 策略查看器 SHALL 使用蓝色
5. WHEN 条状宽度 THEN 策略查看器 SHALL 按照各动作概率比例分配宽度
6. WHEN 某动作概率为0 THEN 策略查看器 SHALL 不显示该动作的条状区域

