# 需求文档

## 简介

本功能旨在训练一个神经网络，使用4组标量特征来预测扑克场景中的期望值（EV）、动作EV和动作策略。该网络将利用已有的验证数据（包含solver计算的精确结果）作为训练目标，学习从简单特征到复杂策略输出的映射关系。

## 术语表

- **EV（Expected Value）**: 期望值，表示在给定场景下的预期收益
- **动作EV（Action EV）**: 每个可选动作的期望值
- **动作策略（Action Strategy）**: 每个动作的选择概率分布
- **Hero Equity**: 英雄手牌相对于对手范围的胜率
- **Range Equity**: 整体范围对范围的胜率
- **EQR（Equity Realization）**: 权益实现率，实际EV与理论权益的比值
- **Solver**: 博弈论求解器，计算纳什均衡策略

## 需求

### 需求 1

**用户故事:** 作为一名扑克AI研究者，我希望能够使用简单的标量特征预测复杂的策略输出，以便在实时决策中快速获得近似最优策略。

#### 验收标准

1. WHEN 系统接收4组标量输入特征 THEN 系统 SHALL 输出整体EV预测值
2. WHEN 系统接收4组标量输入特征 THEN 系统 SHALL 输出每个动作的EV预测值
3. WHEN 系统接收4组标量输入特征 THEN 系统 SHALL 输出每个动作的策略概率分布
4. WHEN 输出策略概率分布 THEN 系统 SHALL 确保所有概率之和等于1.0（误差范围±0.001）

### 需求 2

**用户故事:** 作为一名机器学习工程师，我希望网络能够从验证数据中学习，以便模型能够逼近solver的计算结果。

#### 验收标准

1. WHEN 加载训练数据 THEN 系统 SHALL 从JSON格式的验证数据文件中解析场景信息
2. WHEN 解析场景数据 THEN 系统 SHALL 提取heroEquity、rangeEquity、solverEquity和eqr作为输入特征
3. WHEN 解析场景数据 THEN 系统 SHALL 提取ev、actionEV和strategy作为训练目标
4. WHEN 训练数据包含无效值（NaN或Infinity） THEN 系统 SHALL 跳过该样本并记录警告

### 需求 3

**用户故事:** 作为一名模型训练者，我希望能够配置训练参数，以便根据数据规模和硬件条件优化训练过程。

#### 验收标准

1. WHEN 用户指定学习率 THEN 系统 SHALL 使用该学习率进行优化
2. WHEN 用户指定批次大小 THEN 系统 SHALL 按指定大小分批训练
3. WHEN 用户指定训练轮数 THEN 系统 SHALL 训练指定轮数
4. WHEN 用户指定隐藏层维度 THEN 系统 SHALL 构建相应结构的网络
5. WHEN 训练过程中 THEN 系统 SHALL 每N轮输出一次损失值和验证指标

### 需求 4

**用户故事:** 作为一名模型使用者，我希望能够保存和加载训练好的模型，以便在不同场景中复用。

#### 验收标准

1. WHEN 训练完成 THEN 系统 SHALL 将模型权重保存到指定路径
2. WHEN 用户请求加载模型 THEN 系统 SHALL 从指定路径恢复模型状态
3. WHEN 加载的模型文件不存在 THEN 系统 SHALL 抛出明确的错误信息

### 需求 5

**用户故事:** 作为一名研究者，我希望能够评估模型的预测质量，以便了解模型的实际表现。

#### 验收标准

1. WHEN 评估模型 THEN 系统 SHALL 计算EV预测的均方误差（MSE）
2. WHEN 评估模型 THEN 系统 SHALL 计算动作EV预测的均方误差
3. WHEN 评估模型 THEN 系统 SHALL 计算策略预测的KL散度或交叉熵损失
4. WHEN 评估模型 THEN 系统 SHALL 报告各项指标的统计摘要（均值、标准差、最大值、最小值）

### 需求 6

**用户故事:** 作为一名开发者，我希望网络架构支持不同数量的动作，以便适应不同的下注结构配置。

#### 验收标准

1. WHEN 初始化网络 THEN 系统 SHALL 接受动作数量作为参数
2. WHEN 动作数量为N THEN 系统 SHALL 输出N维的动作EV向量
3. WHEN 动作数量为N THEN 系统 SHALL 输出N维的策略概率向量
4. WHILE 推理过程中 THEN 系统 SHALL 对策略输出应用softmax确保概率有效性
