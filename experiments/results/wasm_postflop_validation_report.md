# 跨公共牌双维度胜率-策略验证实验报告

## 实验目的

验证：**在不同的（公共牌+固定手牌）组合下：**
当以下两个条件同时满足时，策略是否相同？
1. 固定手牌vs对手范围的胜率相近（差异<0.1%）
2. 自己范围vs对手范围的胜率相近（差异<0.1%）

## 实验方法

1. 随机生成公共牌场景
2. 为每个公共牌场景随机选择一个固定手牌（不与公共牌冲突）
3. 对每个（公共牌+固定手牌）组合：
   - 定义双方范围（IP范围和OOP范围）
   - 使用范围vs范围进行CFR求解
   - **Solver自动排除死牌**：计算固定手牌胜率时，自动排除IP范围中与固定手牌冲突的组合
   - 只提取固定手牌的策略（其他手牌策略不参与比较）
   - 计算固定手牌vs对手范围的胜率（胜率 + 平分率/2，已排除冲突组合）
   - 计算范围vs范围的胜率（胜率 + 平分率/2）
4. 在所有场景中，找出双维度胜率都相近的场景对（阈值: 0.1%）
5. 比较这些场景对中固定手牌的策略是否相同

**关键约束：每个公共牌场景只选择一个固定手牌，因为一旦固定了手牌，就不能再从自己范围内采样其他手牌了。**

**死牌处理：wasm-postflop solver在计算每个OOP手牌的胜率时，会自动排除IP范围中与该手牌冲突的组合。**

**胜率比对阈值：0.1%（千分之一）**

## 范围定义

- **OOP范围（位置劣势方）**: AA-22,AKs-A2s,KQs-K2s,QJs-Q2s,JTs-J6s,T9s-T6s,98s-96s,87s-86s,76s-75s,65s-64s,54s,AKo-A2o,KQo-K9o,QJo-Q9o,JTo-J9o,T9o
- **IP范围（位置优势方）**: AA-22,AKs-A2s,KQs-K9s,QJs-Q9s,JTs-J9s,T9s,98s,87s,76s,65s,AKo-ATo,KQo-KJo,QJo

## 实验规模

- 生成场景数: 10000
- 双维度胜率相近的场景对（差异<0.1%）: 2460
- 策略差异显著(>15%)的场景对: 883

## 关键发现

### 发现双维度胜率相近但策略不同的反例

| 场景1 (公共牌+手牌) | 场景2 (公共牌+手牌) | 手牌胜率 | 范围胜率 | 策略差异 |
|---------------------|---------------------|----------|----------|----------|
| Qh 4h 4c Th Qc + 2c2h | Kh As Qh 7s Tc + 2c2h | 4.546% vs 4.570% | 47.006% vs 47.002% | 35.7% |
| Jd 7c Qh 6s 7h + KhKs | Qh 8s 4s 2h Jh + JcJs | 88.503% vs 88.421% | 42.053% vs 42.111% | 34.0% |
| Qh 5h Ac 6d 7d + JdTd | 6c 5s 9h Qc 2c + KdJd | 4.098% vs 4.124% | 43.067% vs 43.092% | 18.2% |
| 3s As 3h 2h Th + AdJh | 4h 9h 8s Kh Ad + AcQd | 73.889% vs 73.795% | 47.085% vs 47.009% | 37.4% |
| 8c 8s Th Jh 5c + 8d8h | Kh 5h Qs 2h Td + AhQh | 100.000% vs 100.000% | 42.791% vs 42.796% | 28.2% |
| 8c 8s Th Jh 5c + 8d8h | 9d 5c 2c Jh 7s + JcJd | 100.000% vs 100.000% | 42.791% vs 42.851% | 24.3% |
| 8c 8s Th Jh 5c + 8d8h | 3d 6h 3s 6d 2s + 6c6s | 100.000% vs 100.000% | 42.791% vs 42.809% | 66.7% |
| 8c 9d 5d Jc Qs + ThTs | 9h 8c Qd 5c Ks + KcKd | 95.596% vs 95.652% | 45.029% vs 44.985% | 37.8% |
| 8c 9d 5d Jc Qs + ThTs | Ad 5c 8s Td 2c + 5d5s | 95.596% vs 95.673% | 45.029% vs 45.107% | 66.6% |
| 5c As Kh 5h 3h + AcQc | 9s 3h Ts 6c Td + 9d8d | 72.093% vs 72.093% | 46.358% vs 46.358% | 44.5% |
| 7c 6c 6d 4h Kd + 9s8s | 3s 6h Jd 7c 5s + Tc9c | 0.698% vs 0.718% | 42.832% vs 42.751% | 39.0% |
| Ac Ts 3c 9c 6s + KhJd | 2h 9s 7d Tc 5d + KcJs | 8.287% vs 8.250% | 49.795% vs 49.787% | 38.1% |
| 6s 3d 5h Qd Jd + AsQh | 4h 5h Jd Td Qs + KdKh | 73.333% vs 73.387% | 40.744% vs 40.655% | 25.7% |
| 2c Td As 3d Qc + TcTh | 5h 2d 2h 8c 7c + QcQd | 88.360% vs 88.333% | 43.818% vs 43.851% | 40.7% |
| 8s Jh 3c Kc 3d + KdJc | 2h 2s 4c 7c Kc + Tc9c | 91.623% vs 91.628% | 41.163% vs 41.090% | 25.0% |
| 6c 9d Tc 6s Ks + KcQc | 5h Qd 2s 3h Qc + JhJs | 73.545% vs 73.560% | 41.242% vs 41.278% | 41.9% |
| Jh 2h 3c 6h 5h + QcQh | Ts Qd Ad 5c 9d + 5h5s | 83.000% vs 82.990% | 47.869% vs 47.927% | 20.7% |
| 8d 8s 5s 5d 9h + TcTs | Ah 9s Kc Qh 4d + KhQd | 80.324% vs 80.357% | 49.164% vs 49.253% | 66.1% |
| 9c As 4c 9d Qh + KsJh | 9s 8h Qh Jh 7h + 3c3d | 12.139% vs 12.136% | 48.820% vs 48.771% | 46.0% |
| 7c 8s 7h 6c 2c + KcKh | 3s 8h 9h As 4d + AhQs | 80.918% vs 81.006% | 44.914% vs 44.830% | 37.7% |

### 详细反例分析

#### 反例: 2c2h vs 2c2h

**场景1:**
- 公共牌: Qh 4h 4c Th Qc
- 固定手牌: 2c2h
- 手牌胜率: 4.546%
- 范围胜率: 47.006%
- 策略: {"Check":0.3691,"Bet":0.164572,"Allin":0.466327}

**场景2:**
- 公共牌: Kh As Qh 7s Tc
- 固定手牌: 2c2h
- 手牌胜率: 4.570%
- 范围胜率: 47.002%
- 策略: {"Check":0.90512,"Bet":0.015511,"Allin":0.079369}

**策略差异: 35.7%**

---

#### 反例: KhKs vs JcJs

**场景1:**
- 公共牌: Jd 7c Qh 6s 7h
- 固定手牌: KhKs
- 手牌胜率: 88.503%
- 范围胜率: 42.053%
- 策略: {"Check":0.489302,"Bet":0.001248,"Allin":0.50945}

**场景2:**
- 公共牌: Qh 8s 4s 2h Jh
- 固定手牌: JcJs
- 手牌胜率: 88.421%
- 范围胜率: 42.111%
- 策略: {"Check":1,"Bet":0,"Allin":0}

**策略差异: 34.0%**

---

#### 反例: JdTd vs KdJd

**场景1:**
- 公共牌: Qh 5h Ac 6d 7d
- 固定手牌: JdTd
- 手牌胜率: 4.098%
- 范围胜率: 43.067%
- 策略: {"Check":0.720485,"Bet":0.279515,"Allin":0}

**场景2:**
- 公共牌: 6c 5s 9h Qc 2c
- 固定手牌: KdJd
- 手牌胜率: 4.124%
- 范围胜率: 43.092%
- 策略: {"Check":0.994,"Bet":0.006,"Allin":0}

**策略差异: 18.2%**

---

#### 反例: AdJh vs AcQd

**场景1:**
- 公共牌: 3s As 3h 2h Th
- 固定手牌: AdJh
- 手牌胜率: 73.889%
- 范围胜率: 47.085%
- 策略: {"Check":0,"Bet":1,"Allin":0}

**场景2:**
- 公共牌: 4h 9h 8s Kh Ad
- 固定手牌: AcQd
- 手牌胜率: 73.795%
- 范围胜率: 47.009%
- 策略: {"Check":0.560048,"Bet":0.439665,"Allin":0.000287}

**策略差异: 37.4%**

---

#### 反例: 8d8h vs AhQh

**场景1:**
- 公共牌: 8c 8s Th Jh 5c
- 固定手牌: 8d8h
- 手牌胜率: 100.000%
- 范围胜率: 42.791%
- 策略: {"Check":1,"Bet":0,"Allin":0}

**场景2:**
- 公共牌: Kh 5h Qs 2h Td
- 固定手牌: AhQh
- 手牌胜率: 100.000%
- 范围胜率: 42.796%
- 策略: {"Check":0.577461,"Bet":0,"Allin":0.422539}

**策略差异: 28.2%**

---

## 结论

### ⚠️ 双维度胜率标量不足以决定最优策略

实验发现：在 2460 对双维度胜率相近（差异<0.1%）的场景中，有 883 对（35.9%）的策略差异显著。

这证明了：**即使固定手牌胜率和范围胜率都精确匹配（差异<0.1%），最优策略仍然可能完全不同。仅靠两个胜率标量无法替代solver。**
